<!-- Buttons to add to the header. -->
<core-navbar-buttons end>
    <core-context-menu>
        <core-context-menu-item *ngIf="externalUrl" [priority]="900" [content]="'core.openinbrowser' | translate" [href]="externalUrl"
            [iconAction]="'open'"></core-context-menu-item>
        <core-context-menu-item *ngIf="description" [priority]="800" [content]="'core.moduleintro' | translate" (action)="expandDescription()"
            [iconAction]="'arrow-forward'"></core-context-menu-item>
        <core-context-menu-item [priority]="700" [content]="'core.refresh' | translate" (action)="doRefresh(null, $event)" [iconAction]="refreshIcon"
            [closeOnClick]="false"></core-context-menu-item>
        <core-context-menu-item *ngIf="prefetchStatusIcon" [priority]="600" [content]="prefetchText" (action)="prefetch()" [iconAction]="prefetchStatusIcon"
            [closeOnClick]="false"></core-context-menu-item>
        <core-context-menu-item *ngIf="size" [priority]="500" [content]="size" [iconDescription]="'cube'" (action)="removeFiles()"
            [iconAction]="'trash'"></core-context-menu-item>
    </core-context-menu>
</core-navbar-buttons>

<!-- Content. -->
<core-loading [hideUntil]="loaded" class="core-loading-center">

    <!-- <ion-card *ngIf="modulesSplittedContentArray[mapIndexToShow]">
    <div class="image-wrapper">
        <div class="hotspot-wrapper" *ngIf="hotspotsLoaded">
            <div 
                *ngFor="let hotspot of modulesSplittedContentArray[mapIndexToShow].hotspotsCoordinates; let i = index"
                [ngStyle]="{'left': hotspot.xValue + '%', 'top': hotspot.yValue + '%'}"
                (click)="showRoomDetails(i)"
                class="hotspot"
            >

                {{i+1}}
            </div>
        </div>
        <img (click)="showMap()" [src]="modulesSplittedContentArray[mapIndexToShow].image | safe_image" [alt]="modulesSplittedContentArray[mapIndexToShow].imageAlt" class="image"/>
    </div>


    <ion-item *ngIf="!showRoomDescription"> 
      <ion-icon name="football" item-start large></ion-icon>
      <h2>{{modulesSplittedContentArray[mapIndexToShow].name}}</h2>
      <p [innerHTML]="modulesSplittedContentArray[mapIndexToShow].description" text-wrap></p>
    </ion-item>
    <ion-item *ngIf="showRoomDescription">
        <ion-thumbnail item-start>
            <img [src]="roomModulesSplittedContentArray[roomIndexToShow].image | safe_image">
        </ion-thumbnail>
        <h2>{{roomModulesSplittedContentArray[roomIndexToShow].name}}</h2>

        <p *ngFor="let paragraph of roomModulesSplittedContentArray[roomIndexToShow].descriptionInParagraphsArray" text-wrap [innerHTML]="paragraph"></p>
        <button ion-button clear item-end (click)="goToRoom(roomIndexToShow)">View</button>
    </ion-item>

  </ion-card>
  <ion-card *ngIf="modulesSplittedContentArray.length && modulesSplittedContentArray.length > 1">
  <ion-list>
    <ion-item-sliding *ngFor="let map of modulesSplittedContentArray; let i = index">
        <ion-item *ngIf="mapIndexToShow !== i">
            <ion-thumbnail item-start>
                <img [src]="map.image | safe_image">
            </ion-thumbnail>
            <h2>{{map.name}}</h2>
            <p text-wrap>{{map.description}}</p>
            <button ion-button clear item-end (click)="changeMap(i)">View</button>
        </ion-item>
        <ion-item-options side="left">
            <button ion-button color="primary">
                <ion-icon name="text"></ion-icon>
                activity
            </button>
        </ion-item-options>
    </ion-item-sliding>

</ion-list>
</ion-card> -->

    <ng-container *ngTemplateOutlet="mapOrRoomTemplate; context: {sectionContent: modulesSplittedContentArray.length ? { map: modulesSplittedContentArray, index: mapIndexToShow, isMap: true} : { map: roomModulesSplittedContentArray, index: roomMapToShow, isMap: false}}"></ng-container>

    <!-- Template to render first section. -->
    <ng-template #mapOrRoomTemplate let-content="sectionContent">
        <ion-card *ngIf="content.map[content.index]">
            <div class="image-wrapper">
                <div class="hotspot-wrapper" *ngIf="hotspotsLoaded">
                    <div *ngFor="let hotspot of content.map[content.index].hotspotsCoordinates; let i = index" [ngStyle]="{'left': hotspot.xValue + '%', 'top': hotspot.yValue + '%'}"
                        (click)="showRoomDetails(i)" class="hotspot">

                        {{i+1}}
                    </div>
                </div>
                <img (click)="showMap(content.isMap === true ? 'map' : 'room')" [src]="content.map[content.index].image | safe_image" [alt]="content.map[content.index].imageAlt"
                    class="image" />

            </div>

            <div *ngIf="content.isMap === true">
                <ion-item *ngIf="!showRoomDescription">
                    <ion-icon name="football" item-start large></ion-icon>
                    <h2>{{content.map[content.index].name}}</h2>
                    <p [innerHTML]="content.map[content.index].description" text-wrap></p>

                    <button ion-button clear item-end (click)="goToList(i, content.isMap ? 'rooms' : 'exponats')">View</button>
                </ion-item>
                <ion-item *ngIf="showRoomDescription">
                    <ion-thumbnail item-start>
                        <img [src]="roomModulesSplittedContentArray[roomIndexToShow].image | safe_image">
                    </ion-thumbnail>
                    <h2>{{roomModulesSplittedContentArray[roomIndexToShow].name}}</h2>
                    <p *ngFor="let paragraph of roomModulesSplittedContentArray[roomIndexToShow].descriptionInParagraphsArray" text-wrap [innerHTML]="paragraph"></p>
                    <button ion-button clear item-end (click)="goToRoom(roomIndexToShow)">View</button>
                </ion-item>
            </div>

            <div *ngIf="content.isMap === false">
                <ion-item *ngIf="!showExponatDescription">
                    <ion-icon name="football" item-start large></ion-icon>
                    <h2>{{content.map[content.index].name}}</h2>
                    <p *ngFor="let paragraph of content.map[content.index].descriptionInParagraphsArray" text-wrap [innerHTML]="paragraph"></p>
                </ion-item>
                <ion-item *ngIf="showExponatDescription">
                    <ion-thumbnail item-start>
                        <img [src]="roomModulesSplittedContentArray[roomIndexToShow].image | safe_image">
                    </ion-thumbnail>
                    <h2>{{roomTopicContent[topicIndexToShow].name}}</h2>

                    <p *ngFor="let paragraph of roomModulesSplittedContentArray[roomIndexToShow].descriptionInParagraphsArray" text-wrap [innerHTML]="paragraph"></p>
                    <button ion-button clear item-end (click)="goToRoom(roomIndexToShow)">View</button>
                </ion-item>
            </div>

        </ion-card>
        <div *ngIf="content.isMap === true && visible" [@slideInOut]>
            <ion-card>
                <ion-list>
                    <ion-item-sliding *ngFor="let room of roomModulesSplittedContentArray; let i = index">
                        <ion-item>
                            <ion-thumbnail item-start>
                                <img [src]="room.image | safe_image" [alt]="room.imageAlt" class="image" />
                            </ion-thumbnail>
                            <h2>{{room.name}}</h2>
                            <p *ngFor="let paragraph of room.descriptionInParagraphsArray" text-wrap [innerHTML]="paragraph"></p>
                            <button ion-button clear item-end (click)="goToRoom(i)">View</button>
                        </ion-item>
                        <ion-item-options side="left">
                            <button ion-button color="primary">
                                <ion-icon name="text"></ion-icon>
                                activity
                            </button>
                            <!-- <div *ngIf="show_inline">
                                    <div class="testcont"></div>
                                    <div class="responsive-video">
                                    <iframe src="https://www.youtube.com/watch?v=k7CzNCc1Krg"
                                    width="1600" height="900" frameborder="0" webkitAllowFullScreen
                                    mozallowfullscreen allowFullScreen></iframe>
                                    </div>
                                </div> -->
                        </ion-item-options>
                    </ion-item-sliding>

                </ion-list>
        </ion-card>
        </div>
        <ion-card *ngIf="content.map.length && content.map.length > 1">
            <ion-list *ngIf="content.isMap === true">
                <ion-item-sliding *ngFor="let map of content.map; let i = index">

                    <ion-item (click)="changeMap(i)" *ngIf="mapIndexToShow !== i">
                        <ion-thumbnail item-start>
                            <img [src]="map.image | safe_image">
                        </ion-thumbnail>
                        <h2>{{map.name}}</h2>
                        <p text-wrap>{{map.description}}</p>
                        <!-- <button ion-button clear item-end (click)="changeMap(i)">View</button> -->
                    </ion-item>
                    <ion-item-options side="left">
                        <button ion-button color="primary">
                            <ion-icon name="text"></ion-icon>
                            activity
                        </button>
                    </ion-item-options>
                </ion-item-sliding>

            </ion-list>
            <ion-list *ngIf="content.isMap === false">
                <ion-item-sliding *ngFor="let map of content.map; let i = index">

                    <ion-item (click)="changeMap(i)" *ngIf="roomIndexToShow !== i">
                        <ion-thumbnail item-start>
                            <img [src]="map.image | safe_image">
                        </ion-thumbnail>
                        <h2>{{map.name}}</h2>
                        <p text-wrap>{{map.description}}</p>
                        <!-- <button ion-button clear item-end (click)="changeMap(i)">View</button> -->
                    </ion-item>
                    <ion-item-options side="left">
                        <button ion-button color="primary">
                            <ion-icon name="text"></ion-icon>
                            activity
                        </button>
                    </ion-item-options>
                </ion-item-sliding>

            </ion-list>
        </ion-card>
    </ng-template>



</core-loading>